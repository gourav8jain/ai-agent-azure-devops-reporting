digraph AzureDevOpsSprintReportingERD {
  rankdir=TB;
  graph [splines=true, nodesep=1.5, ranksep=2.0, size="12,16", dpi=150];
  node [shape=record, fontname="Helvetica", fontsize=12, style=filled, fillcolor=lightblue, width=2.5, height=1.0];
  edge [arrowsize=1.0, fontname="Helvetica", fontsize=10];

  // External Systems
  "Azure DevOps" [shape=cylinder, fillcolor=lightcoral, label="{Azure DevOps|REST API|Work Items|Sprints|Teams}", width=3.0, height=1.5];
  "Gmail SMTP" [shape=cylinder, fillcolor=lightgreen, label="{Gmail SMTP|Email Delivery|Authentication}", width=3.0, height=1.5];

  // Core Data Entities
  "Organization" [label="{Organization|id: string [PK]|name: string|projects: array}"];
  "Project" [label="{Project|id: string [PK]|name: string|team_name: string|tags: array|iteration_path: string|iteration_display: string}"];
  "Sprint" [label="{Sprint|id: string [PK]|name: string|start_date: date|end_date: date|iteration_path: string}"];
  "WorkItem" [label="{WorkItem|id: integer [PK]|title: string|state: string|assigned_to: string|tags: array|created_date: datetime|changed_date: datetime}"];
  "Engineer" [label="{Engineer|name: string [PK]|total_items: integer|states: object|tasks: array}"];

  // Configuration Entities
  "Config" [label="{Config|organizations: object|sprint_period: object|state_categories: object|email_settings: object}"];
  "StateCategory" [label="{StateCategory|category: string [PK]|states: array}"];

  // Data Storage
  "SprintData" [label="{SprintData|timestamp: string [PK]|project_key: string|total_items: integer|engineer_metrics: object}"];
  "HTMLReport" [label="{HTMLReport|timestamp: string [PK]|content: text|file_path: string}"];

  // Relationships
  "Azure DevOps" -> "Organization" [label="contains"];
  "Organization" -> "Project" [label="1:N"];
  "Project" -> "Sprint" [label="1:N"];
  "Sprint" -> "WorkItem" [label="1:N"];
  "WorkItem" -> "Engineer" [label="assigned to"];
  "Engineer" -> "WorkItem" [label="owns"];
  
  "Config" -> "StateCategory" [label="defines"];
  "StateCategory" -> "WorkItem" [label="categorizes"];
  
  "WorkItem" -> "SprintData" [label="aggregated into"];
  "Engineer" -> "SprintData" [label="metrics in"];
  "SprintData" -> "HTMLReport" [label="generates"];
  
  "HTMLReport" -> "Gmail SMTP" [label="sent via"];

  // Data Flow Annotations
  "Azure DevOps" -> "SprintData" [label="extracted via API", style=dashed, color=blue];
  "SprintData" -> "HTMLReport" [label="processed by generator", style=dashed, color=green];
  "HTMLReport" -> "Gmail SMTP" [label="delivered via email", style=dashed, color=red];

  // Key Attributes
  subgraph cluster_structures {
    label="Key Data Structures";
    fontsize=14;
    fontname="Helvetica-Bold";
    
    "WorkItemStructure" [label="{WorkItem Structure|id: integer|title: string|state: string|assigned_to: string|tags: array}", fillcolor=lightyellow, width=2.5, height=1.2];
    "EngineerMetrics" [label="{Engineer Metrics|name: string|total_items: integer|states: object|tasks: array}", fillcolor=lightyellow, width=2.5, height=1.2];
    "ProjectSummary" [label="{Project Summary|project_key: string|total_items: integer|engineer_metrics: EngineerMetrics}", fillcolor=lightyellow, width=2.5, height=1.2];
  }

  // Status Categories
  subgraph cluster_status {
    label="Status Categories";
    fontsize=14;
    fontname="Helvetica-Bold";
    
    "ToDo" [label="To Do\n(Open, TO DO, New, REQ-Review)", fillcolor=lightgray, width=2.0, height=0.8];
    "InProgress" [label="In Progress\n(In Progress, Code Review)", fillcolor=yellow, width=2.0, height=0.8];
    "ReadyForQA" [label="Ready for QA\n(On-QA, Fixed)", fillcolor=orange, width=2.0, height=0.8];
    "QAInProgress" [label="QA in Progress\n(QA Testing, In QA)", fillcolor=lightcoral, width=2.0, height=0.8];
    "ReadyForRelease" [label="Ready for Release\n(QA Reviewed, SIGNOFF)", fillcolor=lightgreen, width=2.0, height=0.8];
    "Done" [label="Done\n(DONE, Done, Closed, Resolved)", fillcolor=green, width=2.0, height=0.8];
  }

  "StateCategory" -> "ToDo";
  "StateCategory" -> "InProgress";
  "StateCategory" -> "ReadyForQA";
  "StateCategory" -> "QAInProgress";
  "StateCategory" -> "ReadyForRelease";
  "StateCategory" -> "Done";
}